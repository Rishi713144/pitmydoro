#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo 'ğŸ” Checking branch protection...'

current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)

remote_ref=$(git rev-parse --abbrev-ref --symbolic-full-name @{push} 2>/dev/null || echo "")
remote_branch=$(echo "$remote_ref" | sed 's/.*\///')

if [ -z "$remote_branch" ]; then
  remote_branch="$current_branch"
fi

protected_branches="master"

for branch in $protected_branches; do
  if [ "$remote_branch" = "$branch" ] || [ "$current_branch" = "$branch" ]; then
    echo "ğŸš« Direct push to '$branch' is not allowed!"
    echo "ğŸ“ Please create a Pull Request instead."
    echo ""
    exit 1
  fi
done

echo 'âœ… Branch check passed! Pushing to remote...'
echo 'ğŸš€ Running tests before push...'
